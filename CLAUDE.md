# Sales Daily - 営業日報アプリ要件定義（デモ版）

**選択プラットフォーム: Web/PWA (Azure 完結)**

- Azure App Service でホスティング

- ブラウザの Azure Speech-to-Text で音声認識

- URL 共有のみで即利用可能

**目的**: AI ヒアリング機能で、移動中の営業日報作成を 3 分以内に完了させる汎用的な営業支援ツール。あらゆる業界の営業担当者が利用可能。Salesforce 連携は将来対応。

## 1. 主要機能

<!-- 1. **議事録起点**

   - 録音 or ファイルインポート → Speech-to-Text＋話者分離 → キーワード抽出・3文要約 → 日報ドラフト自動生成
   - 生成後、AIヒアリング機能で深掘り質問／必須スロット埋めを実行可能 -->

2. **AI ヒアリング起点**

   - ライトな問いかけ（「お疲れ様です！今日どうでしたか？」）で開始

   - 音声入力（Web Speech API や Azure Speech-to-Text の Speech-to-Text 機能を利用）→ テキスト化 → AI 共感応答＋簡易深掘り
   - **入力方法の柔軟性**: 音声入力とテキスト入力を状況に応じて切り替え可能（騒音環境や固有名詞入力時はテキスト推奨）

   - **動的フォローアップ実装**

     1. **スロット管理**
        - LangChain.js や Dialog State Manager で以下のスロットをトラッキング：
          - **顧客名 (customer)**
          - **案件名 (project)**
          - **次アクション (next_action)**
          - **予算 (budget)**
          - **工期／納期 (schedule)**
          - **参加者 (participants)**
          - **場所 (location)**
          - **課題・リスク (issues)**
        - 未入力スロットは会話に自然に組み込み、例：「そうなんですね。ちなみに今回のお客様はどちらの会社でした？」
     2. **カバレッジ判定**
        - OpenAI Embeddings API で回答ベクトル取得 → 初期要件ベクトル集合と cosine-similarity
        - 網羅率が閾値未満なら、自然な問いかけで再質問：例「まだ予算感が伺えていないですが、参考までに予算感はいかがでしたか？」
     3. **信頼度チェック**
        - OpenAI GPT API の `logprobs` や Azure Speech-to-Text の confidence を利用
        - 信頼度が低い箇所は、自然な聞き返しでフォロー：例「すみません、もう一度だけその内容を教えていただけますか？」\
          \*\*
        - OpenAI GPT 系 API の `logprobs` や Azure Speech-to-Text の信頼度スコアを利用
        - スコア下回るトークン範囲を抽出し、該当箇所の再入力を促す
     4. **履歴比較フォロー**

   - **Azure Cognitive Search** のベクター検索機能を利用し、過去日報のベクトルをインデックス化

   - **Azure OpenAI embeddings** で新規回答の埋め込みを生成し、類似度検索

   - 類似度が高すぎる（新情報不足）場合に、差分情報の追加質問を自動生成

   - 必須スロット埋め → 構造化保存 → 構造化保存

3. **編集・手入力**\*\*

   - AI 生成テキストの部分選択修正・加筆
   - キーワードサジェスト／テンプレート挿入

4. **日報管理**

   - 日報一覧検索（顧客名・案件名・日付・タグ）
   - CSV/JSON エクスポート＋メディア ZIP

## 2. Web/PWA 技術スタック

- フレームワーク: React or Vue + PWA 対応（Vite, Workbox）
- **音声認識**:
  - **Web Speech API 優先**: iOS Safari での動作を考慮し、短時間音声入力に最適化
  - **音声入力制限**: 1 回 30 秒以内（iOS での安定動作のため）
  - **シンプルなタップ操作**:
    - 1 回目タップ：録音開始（録音中は赤い ● と波形表示）
    - 2 回目タップ：録音停止・送信
    - 完了ボタン：別途用意（誤タップ防止）
  - **Azure Speech SDK**: 将来的な拡張用（現在は Web Speech API で十分）
- オフライン DB: IndexedDB（idb ライブラリ）
- ネットワーク: Fetch API + async/await
- 多言語: i18next or vue-i18n

## 3. オンライン構成（Azure 完結）

- **オンライン/オフライン ハイブリッド動作**
  - オンライン時：リアルタイムで AI 応答・音声認識・同期
  - オフライン時：テキスト入力・下書き保存のみ可能（IndexedDB 使用）
  - 復帰時：自動同期機能
- データ永続化はすべて Azure 上(Azure Functions→Azure PostgreSQL)
- メディアファイルは Azure Blob Storage に直接アップロード. サーバー・クラウド構成
- **API サーバー**: Azure Functions or Node.js on Azure App Service
- **DB**: Azure Database for PostgreSQL Flexible
- **Storage**: Azure Blob Storage for メディアファイル
- **AI**: Azure Cognitive Services Speech-to-Text + LUIS
- **CI/CD**: GitHub Actions 無料枠内でビルド → デプロイ

## 4. 認証・セキュリティ

- **認証方式**: メール/パスワード認証（JWT トークン使用）
- **ユーザー種別**:
  - **営業担当者**: 自分の日報のみ作成・閲覧・編集可能
  - **マネージャー**: 自分の日報 ＋ 部下の日報閲覧可能（編集不可）
- **階層管理**:
  - 各営業担当者に manager_id を設定
  - マネージャーは配下の営業担当者リストを保持
  - 複数階層対応（部長 → 課長 → 担当者）
- **アクセス制御**:
  - 営業: 自分の日報のみ（user_id = 自分）
  - マネージャー: 自分 ＋ 部下の日報（manager_id = 自分 OR user_id = 自分）
- **セッション管理**:
  - JWT 有効期限: 24 時間
  - リフレッシュトークン: 7 日間
  - 自動ログアウト: 30 分無操作時
- **パスワード要件**:
  - 最小 8 文字、英数字混在
  - パスワードリセット機能（メール送信）

## 5. UI/UX 設計

### 画面構成：

1. **ログイン画面**

   - メールアドレス/パスワード入力
   - パスワードリセットリンク

2. **ホーム画面**

   - ネットワーク状態表示（🟢 オンライン/🟡 オフライン）
   - 日報作成開始ボタン（音声/テキスト選択）
   - 最近の日報一覧
   - **営業担当者向け**:
     - 「マイ分析」ボタン → 個人ダッシュボードへ
     - AI コーチからの今日のアドバイス表示
   - **マネージャー向け**:
     - 部下選択タブ（「自分」「チーム全体」「個別選択」）
     - 部下の日報一覧（閲覧のみ、名前付き表示）
     - 「チーム分析」ボタン → チームダッシュボードへ
     - AI マネジメントコーチからの本日の提案（アラート表示）

3. **AI ヒアリング画面**

   - 進捗インジケーター（例：3/5 質問目）
   - AI 質問表示エリア
   - ユーザー回答表示エリア
   - 入力方法：
     - 通常時: [🎤 音声入力] [📝 テキスト入力] ボタン
     - 録音中: [● 録音中...] と音声波形表示、[■ 停止して送信] ボタン
   - スキップボタン

4. **日報確認・編集画面**
   - 構造化された日報内容表示
   - 各項目の編集ボタン
   - 保存/AI に追加質問ボタン

### デザイン方針：

- モバイルファースト（特に iPhone 最適化）
- シンプルで直感的な UI
- 大きめのボタン（移動中でも押しやすい）
- iOS Safari 対応（PWA インストール可能）

## 6. エラーハンドリング

### 主要なエラーケース：

1. **音声認識エラー**

   - 騒音/不明瞭 → テキスト入力への切り替え提案
   - タイムアウト → 再試行またはテキスト入力

2. **ネットワークエラー**

   - API 接続失敗 → オフラインモード継続確認
   - 同期失敗 → 下書き保存＋再試行案内

3. **認証エラー**

   - セッション切れ → 再ログイン誘導
   - 認証失敗 → エラーメッセージ表示

4. **入力検証エラー**
   - 必須項目 → 具体的な項目名で案内
   - 文字数制限 → 残り文字数表示

## 7. 非機能要件

- 可用性: 99.9%
- 性能: 音声解析 50MB／60 秒以内
- セキュリティ: HTTPS, データ暗号化

## 8. 受け入れ基準

| 項目           | 内容                  |
| -------------- | --------------------- |
| ヒアリング起点 | 3 分以内完了          |
| 抽出精度       | キーワード 90%以上    |
| UX             | 主要操作 3 タップ以内 |

---

**最終出力形式**

- **JSON スキーマ**で質問と回答を構造化

```json
{
	"report_id": "UUID",
	"date": "YYYY-MM-DD",
	"mode": "meeting|hearing",
	"questions_answers": [
		{
			"question": "今日はどのような商談がありましたか？",
			"answer": "顧客ABC社と新規設備導入について話しました。",
			"timestamp": "10:15:30"
		},
		{
			"question": "次のアクションは何ですか？",
			"answer": "見積もりを5営業日以内に提出します。",
			"timestamp": "10:17:05"
		}
	],
	"slots": {
		"customer": "ABC社",
		"project": "新規設備導入",
		"next_action": "見積もり提出",
		"budget": "¥1,000万円",
		"schedule": "2025-08-31まで",
		"participants": ["田中太郎", "営業部長"],
		"location": "東京本社",
		"issues": "現場のアクセス制限"
	}
}
```

- **拡張性**: 上記 JSON はそのまま Salesforce REST API の Payload にマッピング可能
  - `report_id` を External ID として Upsert 実行
  - `slots` フィールドは Commerce Cloud のカスタムオブジェクトへ連携

## 9. 開発フェーズ計画

### Phase 1: 基盤構築（1 週間）

- Azure 環境セットアップ（Functions, PostgreSQL, App Service）
- 認証機能実装（営業・マネージャー権限管理）
- DB 設計（ユーザー、日報、階層管理）
- 基本的な UI/UX フレームワーク構築

### Phase 2: コア機能実装（1 週間）

- AI ヒアリング機能
  - Azure OpenAI API 統合
  - 動的フォローアップ実装
  - スロット管理システム
- 音声/テキスト入力切り替え
- 日報の作成・保存・編集機能
- オフライン対応（IndexedDB、同期機能）

### Phase 3: マネージャー機能（3-4 日）

- 部下の日報閲覧機能
- チーム/個人切り替え UI
- 権限管理の実装

### Phase 4: 分析機能（1 週間）

- **個人向け AI 分析**（営業担当者用）：

  - **マイダッシュボード**：
    - 自分の活動推移（訪問数、商談数、成約率）
    - 顧客別の商談履歴・進捗状況
    - 今週/今月の目標達成状況
  - **AI パーソナルコーチ機能**：
    - 「最近〇〇建設への訪問が減っています。フォローアップしましょう」
    - 「先月と比べて成約率が向上しています！この調子で頑張りましょう」
    - 「明日の訪問予定が入っていません。スケジュール確認をお勧めします」
  - **スキル分析**：
    - 得意な顧客タイプの分析
    - 成約につながりやすい行動パターン
    - 改善ポイントの提案

- **マネージャー向け分析**：
  - **チームダッシュボード**：
    - チーム全体の日報提出率（日次/週次/月次）
    - 部下別の活動量・成果比較
    - 案件ステータス分布（商談中/見積中/成約/失注）
  - **AI マネジメントコーチ機能**：
    - **個別指導アラート**：
      - 「田中さんの活動量が先週比 30%減。面談を推奨します」
      - 「鈴木さんの成約率が低下傾向。商談同行を検討してください」
      - 「山田さんは 3 日連続で日報未提出です」
    - **ベストプラクティス共有提案**：
      - 「佐藤さんの〇〇建設への提案手法が成功。チーム共有を推奨」
      - 「今週の成約事例：△△ 工法の提案が 3 件成約。勉強会開催を提案」
      - 「顧客 A タイプには、チーム内で鈴木さんのアプローチが最も効果的です」
    - **マネジメント改善提案**：
      - 「チーム全体の士気が低下傾向。1on1 面談の頻度を上げましょう」
      - 「新人の〇〇さんは順調に成長中。褒めてあげましょう」
      - 「来月の目標達成には、あと 5 件の商談が必要です」
  - **AI 分析機能**：
    - チーム全体の傾向分析
    - スキルマトリックス自動生成（誰が何に強いか）
    - 最適な人員配置の提案
- **共通レポート機能**：
  - CSV/Excel エクスポート
  - PDF 月次レポート生成（個人用/チーム用）

### Phase 5: 品質向上とデプロイ（3-4 日）

- 包括的なテスト
- パフォーマンス最適化
- セキュリティ監査
- 本番環境デプロイ
- ドキュメント作成

### 完成時の全機能：

✅ メール/パスワード認証（営業・マネージャー区分）
✅ AI ヒアリング（動的フォローアップ対応）
✅ 音声/テキスト入力切り替え
✅ 日報の保存・編集・一覧表示
✅ マネージャーによる部下の日報閲覧
✅ 管理者向け分析ダッシュボード
✅ AI 分析レポート
✅ データエクスポート機能
✅ オフライン対応
✅ 包括的なエラー処理

### 将来の拡張：

- 議事録からの自動生成（音声ファイルアップロード対応）
- Salesforce/CRM 連携
- モバイルアプリ版（React Native）
- **高度な分析機能**：
  - 成約率の高い営業パターンの AI 分析
  - 部下別の強み・弱み自動診断
  - 予測分析（来月の成約見込み等）
  - 競合他社動向の自動収集・分析
